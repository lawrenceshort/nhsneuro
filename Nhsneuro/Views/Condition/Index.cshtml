@{
    ViewBag.Title = "Index";
}
<h2>Index</h2>
<div>

    <select
        id="symptomsSelectList"
        name="symptoms"
        data-source="/api/symptoms"
        data-valueKey="SymptomId"
        data-displayKey="Name">
    </select>
    <button onclick="addItem()">add item</button>

    <ul id="selectedSymptoms"></ul>

    <table class="table table-bordered table-striped table-responsive">
        <th>Name</th>
        <th>Description</th>
        <th>Rare</th>
        <th>SnoMedID</th>
        <th>Symptoms</th>
        @foreach (var Condition in ViewData["Conditions"] as IEnumerable<Condition>)
        {
            <tr>
                <td>@Condition.Name</td>
                <td>@Condition.Description</td>
                <td>@Condition.IsRare</td>
                <td>@Condition.SnoMedId</td>
                <td>
                    @if (@Condition.ConditionSymptoms.Any())
                    {
                        <ol>
                            @foreach (var symptom in @Condition.ConditionSymptoms.Select(s => s.Symptom.Name))
                            {
                                <li>@symptom</li>
                            }
                        </ol>
                    }
                </td>
            </tr>
        }
    </table>

    @section scripts{
        <script type="text/javascript">
            $('select[data-source]').each(function() {
                var $select = $(this);

                $select.append('<option></option>');

                $.ajax({
                    url: $select.attr('data-source')
                }).then(function(options) {
                    options.map(function(option) {
                        var $option = $('<option>');

                        $option
                            .val(option[$select.attr('data-valueKey')])
                            .text(option[$select.attr('data-displayKey')]);

                        $select.append($option);

                    });
                });
            });

            function addItem(){
                var ul = document.getElementById("selectedList");
                var symptom = $('symptomsSelectList').find(':selected').text();
                var li = document.createElement("li");
                li.setAttribute('id',candidate.value);
                li.appendChild(document.createTextNode(candidate.value));
                ul.appendChild(li);
            }
        </script>
    }

</div>